<div>
  <toaster-container></toaster-container>
  <link rel="stylesheet" ng-href="{{ styleUrl }}" />
  <div class="navbar navbar-inverse">
    <ul class="nav navbar-nav navbar-left">
      <div class="choise-select">
        <span>Project</span>
        <select ng-model="selected_project" ng-options="project.name for project in user_projects track by project.id" ng-change="goToProject(selected_project)"></select>
      </div> 
      <button class='btn btn-info' ng-click='refresh()'>Reload</button>
      <a href="#">Scrummer</a>
    </ul>
  </div> <!-- end of navbar -->

  <div class="page-header">
    <div class="col-headers col-lg-3 col-md-3 col-xs-3">
      <span>Defined</span>
    </div>
    <div class="col-headers col-lg-3 col-md-3 col-xs-3">
      <span>Inprogress</span>
    </div>
    <div class="col-headers col-lg-3 col-md-3 col-xs-3">
      <span>Completed</span>
    </div>
    <div class="col-headers col-lg-3 col-md-3 col-xs-3">
      <span>Activities</span>
    </div>
  </div> <!-- end of page-header -->

  <div gridster="gridsterOptions">
    <div ng-model="widgets">
      <ul>
        <li gridster-item="widget" ng-repeat="widget in widgets | filter: {allowed: true}">
          <div class="box column-box" ng-controller="CustomWidgetCtrl">
            <div class="box-header">
              <section>
                <h3>{{widget.title}}</h3>
              </section>
              <div class="box-header-btns pull-right">
                <i>{{widget.cards.length}}</i>
                  <a title="settings" ng-click="openSettings(widget)"><i class="glyphicon glyphicon-cog"></i></a>
                  <a title="Remove widget" ng-click="remove(widget)"><i class="glyphicon glyphicon-trash"></i></a>
              </div>
            </div> <!-- end of box-header -->
            <div class="box-content">
              <ul class="connectedSortable" ui-sortable="sortableTemplates" sortable ng-model="widget.cards" widget-status="{{widget.status_id}}">
                <li class="card" ng-repeat="card in widget.cards" id="{{card.id}}" ng-controller="CardCtrl">
                  <div class="card-header heigh">
                    <a ng-href="http://{{config.host}}/issues/{{card.id}}" target="_blank" class="id">{{card.id}}</a>
                    <h5>{{card.subject}}</h5>
                  </div> <!-- end of card-header -->

                  <accordion close-others="oneAtATime">
                    <accordion-group>
                      <accordion-heading><i id="accord-{{card.id}}" ng-hide="false" href="#" class=""></accordion-heading>
                      <div ng-repeat="task in card.subTasks track by $index" class="task-component" ng-controller="ExistingTaskCtrl" ng-include="'views/templates/view_task.html'">
                      </div> <!-- end of task card.subTasks -->
                    </accordion-group>
                  </accordion>

                  <div class="card-footer">
                    <div class="task-user">
                      <div class="task-user-img">
                       <img class="us-member member" title="{{card.assigned_to.name}}" gravatar-src="card.assigned_to.mail" gravatar-size="100" />
                      </div>
                      <span>{{card.assigned_to.name}}</span>
                    </div> <!-- end of task-user -->
                    <div class="card-btns">
                      <ul>
                        <li><a href="" ng-click="addNewSubTask(card)" data-toggle="modal" data-target="#addSubtask-modal" ng-controller="NewTaskCtrl"> <i class="fa fa-plus"></i></a></li>

                        <li ng-show="card.hasAttachments" ><a href="#" class=""><i class="fa fa-paperclip"></i></a></li>

                        <li><a href="#" ng-click="editCard(widget, card)" class="" data-toggle="modal" data-target="#userStoryModal"><i class="fa fa-arrows-alt"></i></a></li>

                        <li><a href="#" trigger-card-accordion class="toggle-btn"><i class="fa fa-arrows-v"></i></a></li>

                      </ul>
                    </div> <!-- end of card-btns -->
                  </div> <!-- end of card-footer -->

                    <!--<p>
                        <a ng-href="http://{{config.host}}/issues/{{card.id}}" target="_blank">{{card.subject}}</h3></a>
                    </p>-->
                  <div id="overlay">
                    <img id="loading" src="http://bit.ly/pMtW1K "></img>
                  </div> <!-- end of overlay -->
                </li> <!-- end of card -->
                <li ng-show="widget.cards.length===0" style="background-color: #CCEEFA; visibility: hidden;">&nbsp;</li>
              </ul>
              <ng-include src="'views/templates/new_card_form.html'"></ng-include>
            </div> <!-- end of box-content -->
          </div> <!-- end of box -->
        </li> <!-- end of widget -->
       
       <li gridster-item="widget">
          <div class="box column-box" ng-controller="CustomWidgetCtrl">
            <div class="box-header">
                <section>
                    <h3>Project Activities</h3>
                </section>
            </div>
            <div ng-repeat="activity in activities track by $index" class="box-content activity-box-content">
                <!--<ul>
                    <li ng-repeat="activity in activities track by $index">{{activity.author.name}}<br>{{activity.time}}<br>{{activity.title}}<br><div ng-bind-html="parseTrustSnippt(activity.description)"></div><br></li>
                </ul>-->
                <div  class="activity-details">
                  <b>{{activity.title}}</b>
                  <b>{{activity.time}}</b>
                  <b>{{activity.author.name}}</b>
                  <p><div ng-bind-html="parseTrustSnippt(activity.description)"></div></p>
                </div>
                <div class="activity-img">
                  <img title="{{activity.author.name}}" gravatar-src="activity.author.email" gravatar-size="50">
                </div>
            </div>
          </div>

        </li>

      </ul>
    </div> <!-- end of widgets -->
  </div> <!-- end of gridsterOptions -->
</div> <!-- end of largest container -->
