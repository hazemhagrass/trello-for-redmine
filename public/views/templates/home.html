<div>
  <toaster-container></toaster-container>
  <div class="navbar navbar-inverse">
    <ul class="nav navbar-nav navbar-left">
      <div class="choise-select">
        <span>Project</span>
        <select ng-model="selected_project" ng-options="project.name for project in user_projects track by project.id" ng-change="goToProject(selected_project)"></select>
      </div> 
      <button id="top-reload" class='btn btn-info' ng-click='refresh()'>&#xf021;  Reload</button>
      <form id="top-buttons" action="{{logoutUrl}}" ng-controller='LogoutCtrl' method="POST" ng-submit='logout()'>
        <input class='btn btn-info'  type="submit" value="&#xf08b;  Sign Out" />
      </form>
    </ul>
  </div> <!-- end of navbar -->
  <div class="page-header">
    <div class="col-headers defined col-lg-3 col-md-3 col-xs-3">
      <span><i ng-show="widgets[7].loader"><i class="fa fa-spinner fa-spin"></i></i><i class="fa fa-folder-open"></i>Defined</span>
      <span class="add-card" ng-click="addNewCard(7)" ng-controller="NewCardCtrl" title="Add Card"><i class="fa fa-plus"></i>Add Card</span>
    </div>
    <div class="col-headers in-progress col-lg-3 col-md-3 col-xs-3">
      <span><i ng-show="widgets[8].loader"><i class="fa fa-spinner fa-spin"></i></i><i class="fa fa-sliders"></i>In Progress</span>
      <span class="add-card" ng-click="addNewCard(8)" ng-controller="NewCardCtrl" title="Add Card"><i class="fa fa-plus"></i>Add Card</span>
    </div>
    <div class="col-headers completed col-lg-3 col-md-3 col-xs-3">
      <span><i ng-show="widgets[9].loader"><i class="fa fa-spinner fa-spin"></i></i><i class="fa fa-check"></i>Completed</span>
      <span class="add-card" ng-click="addNewCard(9)" ng-controller="NewCardCtrl" title="Add Card"><i class="fa fa-plus"></i>Add Card</span>
    </div>
    <div class="col-headers activities col-lg-3 col-md-3 col-xs-3">
      <span><i ng-show="activities.loader"><i class="fa fa-spinner fa-spin"></i></i><i class="fa fa-users"></i>Activities</span>
    </div>
  </div> <!-- end of page-header -->

  <div gridster="gridsterOptions">
    <div ng-model="widgets">
      <ul id="widget-columns">
        <li gridster-item="widget" ng-repeat="widget in widgets | filter: {allowed: true}" class="one-column">
          <div class="box column-box" ng-controller="CustomWidgetCtrl">
            <div class="box-header">
              <section>
                <h3>{{widget.title}}</h3>
              </section>
              <div class="box-header-btns pull-right">
                <i>{{widget.cards.length}}</i>
                  <a title="settings" ng-click="openSettings(widget)"><i class="glyphicon glyphicon-cog"></i></a>
                  <a title="Remove widget" ng-click="remove(widget)"><i class="glyphicon glyphicon-trash"></i></a>
              </div>
            </div> <!-- end of box-header -->
            <div class="box-content">
              <ul class="connectedSortable" ui-sortable="sortableTemplates" sortable ng-model="widget.cards" widget-status="{{widget.status_id}}">
                <li class="card element" ng-repeat="card in widget.cards" id="{{card.id}}" ng-controller="ExistingCardCtrl">
                  <div class="card-header heigh">
                    <a ng-href="http://{{config.redmine_host}}/issues/{{card.id}}" target="_blank" class="id">{{card.id}}</a>
                    <h5>{{card.subject}}</h5>
                  </div> <!-- end of card-header -->

                  <accordion close-others="oneAtATime">
                    <accordion-group>
                      <accordion-heading><i id="accord-{{card.id}}" ng-hide="false" href="#" class=""></accordion-heading>
                      <div ng-repeat="task in card.subTasks track by $index" class="task-component" ng-controller="ExistingTaskCtrl" ng-include="'views/templates/view_task.html'">
                      </div> <!-- end of task card.subTasks -->
                    </accordion-group>
                  </accordion>

                  <div class="card-footer">
                    <div class="task-user">
                      <div class="task-user-img">
                       <img class="us-member member" title="{{card.assigned_to.name}}" gravatar-src="card.assigned_to.mail" gravatar-size="100" />
                      </div>
                      <span>{{card.assigned_to.name}}</span>
                    </div> <!-- end of task-user -->
                    <div class="card-btns">
                      <ul>
                        <li><a ng-show="card.card_loading"><i class="fa fa-spinner fa-spin" title="Loading Card"></i></a></li>

                        <li><a href="" ng-click="addNewSubTask(card)" data-toggle="modal" data-target="#addSubtask-modal" ng-controller="NewTaskCtrl" title="Add Task"> <i class="fa fa-plus"></i></a></li>

                        <li><a ng-show="card.description.length" ng-click="openDescription(card)"><i class="fa fa-laptop" title="Open Description"></i></a></li>

                        <li ng-show="card.hasAttachments" ><a href="#" class="" title="Contains Attachments"><i class="fa fa-paperclip"></i></a></li>

                        <li><a href="#" ng-click="editCard(widget, card)" class="" data-toggle="modal" data-target="#userStoryModal" title="Edit Card"><i class="fa fa-pencil"></i></a></li>

                        <li><a href="#" trigger-card-accordion class="toggle-btn" title="{{accordion_icon_title}}" ng-show="card.subTasks.length"><i class="fa fa-arrows-v"></i></a></li>

                      </ul>
                    </div> <!-- end of card-btns -->
                  </div> <!-- end of card-footer -->

                    <!--<p>
                        <a ng-href="http://{{config.redmine_host}}/issues/{{card.id}}" target="_blank">{{card.subject}}</h3></a>
                    </p>-->
                  <!-- <div id="overlay" ng-show="card.card_loading">
                    <img id="loading" src="/assets/images/spiffygif_134x134.gif"></img>
                  </div> --> <!-- end of overlay -->
                </li> <!-- end of card -->
              </ul>
            </div> <!-- end of box-content -->
          </div> <!-- end of box -->
        </li> <!-- end of widget -->
       
       <li gridster-item="widget">
          <div class="box column-box" ng-controller="CustomWidgetCtrl">
            <div class="box-header">
                <section>
                    <h3>Project Activities</h3>
                </section>
            </div>
            <!-- ngAnimate does NOT work with track by $index -->
            <div ng-repeat="activity in activities" class="box-content activity-box-content" ng-class="{'activity-animate' : activity.animate}" >
                <div class="activity-details">
                  <b>{{activity.title}}</b>
                  <b>{{activity.time}}</b>
                  <b>{{activity.author.name}}</b>
                  <p><div ng-bind-html="parseTrustSnippt(activity.description)"></div></p>
                </div>
                <div class="activity-img">
                  <img title="{{activity.author.name}}" gravatar-src="activity.author.email" gravatar-size="50">
                </div>
            </div>
          </div>

        </li>

      </ul>
    </div> <!-- end of widgets -->
  </div> <!-- end of gridsterOptions -->
</div> <!-- end of largest container -->
